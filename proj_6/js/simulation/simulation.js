var hash;var data;var ready = false;var num_days = 0;var num_stocks = 0;var value_over_time;var gains_losses;var max_drawdown;//Initialize variablesvar owned_stocks;var sell_stocks;var buy_stocks;var cash;function init_data(){    var prom = getData();    prom.then(function(obj)    {        data = obj.Data;        hash = obj.Hash;        num_stocks = 549;        num_days = data[0].length;        //console.log(data);        ready = true;        run_simulation();    });}function run_simulation(){    owned_stocks = new Array(num_stocks);    for(i = 0; i < num_stocks; ++i)    {        owned_stocks[i] = 0;    }    cash = g_StartMoney;    value_over_time = [];    value_over_time.push(+cash);    gains_losses = [];    max_drawdown = 0;    //for each day (simulation_loop)    for(day = num_days - 252; day < num_days; ++day)    {        buy_stocks = new Array(num_stocks);        sell_stocks = new Array(num_stocks);        for(i = 0; i < num_stocks; ++i)        {            buy_stocks[i] = 0;            sell_stocks[i] = 0;        }        //identify stocks to sell        var new_cash = cash;        for(stock_index = 0; stock_index < num_stocks; ++stock_index)        {            //Sell all stocks            //HACK - check num days stock has            if(data[stock_index].length != 2713) continue;            new_cash += +owned_stocks[stock_index] * +data[stock_index][day].Adjusted_close;        }        //identify stocks to buy        var break_flag = false;        var spent_cash = 0;        while(true)        {            //Buy random stocks until out of money            var stock_index = Math.floor(Math.random() * num_stocks);            //HACK - check num days stock has            if(data[stock_index].length != 2713) continue;            var value = +data[stock_index][day].Adjusted_close;            if(spent_cash + value > new_cash) break;            //TEMP - debugging            //if(new_cash == NaN) return;            spent_cash += value;            ++buy_stocks[stock_index];        }        //record gain/loss percentage        var drawdown = (1.0 * new_cash) / value_over_time[value_over_time.length - 1] - 1;        if(drawdown < max_drawdown) max_drawdown = drawdown;        gains_losses.push(drawdown);        //record account value        value_over_time.push(+new_cash);        //sell selected stocks        new_cash -= spent_cash;        //buy selected stocks        owned_stocks = buy_stocks;        cash = new_cash;    }    //TODO - calculate statistics    //console.log(value_over_time);    //console.log(gains_losses);    //console.log(max_drawdown);    BuildGainsHistogram();    AfterLoadLine();    SetAllStats();}init_data();